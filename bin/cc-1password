#! /bin/sh
set -e -u

store_token_keychain(){
    security add-generic-password -a "$USER" -s 'op_token' -w "$1" -U
}

get_token_keychain(){
    security find-generic-password -a "$USER" -s 'op_token' -w
}

get_op_token(){
   new_token=$(op signin --session="$(get_token_keychain)" --raw)
   store_token_keychain "$new_token"
   echo "$new_token"
}

get_password() {
   op get item "$1" --fields password --session="$(get_token_keychain)"
}

get_password "Chameleon CLI"
